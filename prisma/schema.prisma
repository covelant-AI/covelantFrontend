generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Player {
  id           Int      @id @default(autoincrement())
  firstName    String?
  lastName     String?
  email        String
  avatar       String?
  age          Int?
  dominantHand String?  @default("Right Handed")
  height       Int?     @default(180)
  Tier         String?  @default("Professional")
  winRate      Float?   @default(1)
  stats        PlayerStat[]

  // break out the two “slots” of PlayerMatch
  playerMatchesFirst  PlayerMatch[] @relation("PlayerMatch_First")
  playerMatchesSecond PlayerMatch[] @relation("PlayerMatch_Second")

  coaches      Coach[]  @relation("CoachPlayers")

  overallStats OverallStats?  // relation field without attributes
}

model Coach {
  id        Int      @id @default(autoincrement())
  firstName String
  lastName  String
  avatar    String?
  email     String
  team      String?
  age       Int?

  players   Player[] @relation("CoachPlayers")
}

model PlayerStat {
  id        Int     @id @default(autoincrement())
  subject   String
  value     Int
  playerId  Int
  player    Player  @relation(fields: [playerId], references: [id])

  @@index([playerId])
}

model OverallStats {
  id               Int     @id @default(autoincrement())
  wins             Int     @default(0)
  losses           Int     @default(0)
  setsWon          Int     @default(0)
  setsLost         Int     @default(0)
  totalMatches     Int     @default(0)
  avgMatchDuration Float   @default(0)

  playerId         Int     @unique
  player           Player  @relation(fields: [playerId], references: [id])
}

model Match {
  id            Int           @id @default(autoincrement())
  videoUrl      String?
  imageUrl      String?
  type          String?
  result        String?
  fieldType     String?
  status        String?
  date          DateTime
  videoType     String
  playerMatches PlayerMatch[]

  // New relation: “events” attached to this match
  events        MatchEvent[]
}

model StatMatch {
  id        Int    @id @default(autoincrement())
  condition String?
}

model Opponent {
  id            Int           @id @default(autoincrement())
  firstName     String
  lastName      String
  playerMatches PlayerMatch[]
}

model PlayerMatch {
  id           Int       @id @default(autoincrement())
  matchId      Int
  result       String
  match        Match     @relation(fields: [matchId], references: [id])

  // First player slot
  playerId     Int?
  player       Player?   @relation("PlayerMatch_First", fields: [playerId], references: [id])

  // Second player slot (for player-vs-player)
  playerTwoId  Int?
  playerTwo    Player?   @relation("PlayerMatch_Second", fields: [playerTwoId], references: [id])

  // Opponent slot (for player-vs-opponent)
  opponentId   Int?
  opponent     Opponent? @relation(fields: [opponentId], references: [id])

  /// Enforce uniqueness per “mode”:
  @@unique([matchId, playerId, playerTwoId])   // no two identical P-vs-P rows
  @@unique([matchId, playerId, opponentId])    // no two identical P-vs-O rows
}

/// New enums:

/// Defines which category this event belongs to.
enum EventCategory {
  MATCH
  TACTIC
  FOULS
  PHYSICAL
  COMMENT
}

/// “type” values for the MATCH category.
enum MatchEventType {
  FIRST_SERVE
  SECOND_SERVE
  BREAK_POINT
  GAME_POINT
  SET_POINT
  TIEBREAK
  START_OF_SET
}

/// “type” values for the TACTIC category.
enum TacticEventType {
  SERVE_VOLLEY
  BASELINE_RALLY
  DROP_SHOT
  NET_PLAY
  CROSS_COURT_RALLY
  DOWN_THE_LINE_SHOT
  OPPONENT_PULLED_WIDE
}

/// “type” values for the FOULS category.
enum FoulsEventType {
  UNFORCED_ERROR
  FORCED_ERROR
  DOUBLE_FAULT
  FOOT_FAULT
  NET_TOUCH
  RACKET_VIOLATION
}

/// “type” values for the PHYSICAL category.
enum PhysicalEventType {
  FATIGUE_SIGN
  SLOW_RECOVERY
  INJURY_CONCERN
  GOOD_MOVEMENT
  POOR_FOOTWORK
}

/// Shared “condition” for MATCH, TACTIC, FOULS, PHYSICAL categories.
enum ConditionType {
  UNDER_PRESSURE
  CONFIDENT
  FOCUSED
  LOST_FOCUS
  MOMENTUM_SHIFT
  CLUTCH_PLAY
  FATIGUE_SIGNS
}

/// New model that stores any of the five categories in one table:
model MatchEvent {
  id               Int               @id @default(autoincrement())
  matchId          Int
  match            Match             @relation(fields: [matchId], references: [id])
  category         EventCategory
  comment          String?

  /// If category = MATCH, this field may be set (else remains null)
  matchType        MatchEventType?

  /// If category = TACTIC, this field may be set (else remains null)
  tacticType       TacticEventType?

  /// If category = FOULS, this field may be set (else remains null)
  foulType         FoulsEventType?

  /// If category = PHYSICAL, this field may be set (else remains null)
  physicalType     PhysicalEventType?

  /// If category = COMMENT, store the user’s free‐text comment here (else remains null)
  commentText      String?

  /// For MATCH, TACTIC, FOULS, PHYSICAL: store one of the ConditionType values. Null if category = COMMENT
  condition        ConditionType?

  /// The timestamp (in seconds from video start) at which this event occurred
  eventTimeSeconds Float

  /// When this event was created
  createdAt        DateTime          @default(now())

  @@index([matchId, category])
}






